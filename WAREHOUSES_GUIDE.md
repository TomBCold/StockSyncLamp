# Руководство по настройке складов МойСклад

## Как найти ID склада в МойСклад

### Способ 1: Через веб-интерфейс

1. **Откройте МойСклад** и войдите в свой аккаунт
2. Перейдите в **Справочники** → **Склады**
3. Кликните на нужный склад для открытия карточки
4. В адресной строке браузера найдите ID склада

**Формат URL:**
```
https://online.moysklad.ru/app/#company/edit?id=XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
```

**ID склада:** `XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX` (UUID формат)

### Способ 2: Через API (для продвинутых)

Запрос списка всех складов:
```bash
curl -X GET "https://api.moysklad.ru/api/remap/1.2/entity/store" \
  -H "Authorization: Basic <your-base64-credentials>" \
  -H "Content-Type: application/json"
```

Ответ содержит массив складов с их ID.

---

## Формат файла warehouses.txt

### Простой вариант (только ID)

```
12345678-1234-1234-1234-123456789abc
87654321-4321-4321-4321-cba987654321
aaaabbbb-cccc-dddd-eeee-ffffffffffff
```

### С комментариями (рекомендуется)

```
# Основной склад (Москва)
12345678-1234-1234-1234-123456789abc

# Региональный склад (Санкт-Петербург)
87654321-4321-4321-4321-cba987654321

# Склад возврата
aaaabbbb-cccc-dddd-eeee-ffffffffffff
```

---

## Правила заполнения

✅ **Правильно:**
```
# Комментарий
12345678-1234-1234-1234-123456789abc
87654321-4321-4321-4321-cba987654321
```

❌ **Неправильно:**
```
"12345678-1234-1234-1234-123456789abc"    # Не нужны кавычки
12345678-1234-1234-1234-123456789abc,     # Не нужны запятые
Склад-1                                    # Не название, а ID
```

---

## Проверка правильности ID

### Формат UUID

ID склада должен соответствовать формату UUID v4:
- 8 символов - 4 символа - 4 символа - 4 символа - 12 символов
- Используются цифры (0-9) и буквы (a-f)
- Разделители: дефис (-)

**Пример правильного ID:**
```
a1b2c3d4-e5f6-7890-abcd-ef1234567890
```

### Тестирование

После добавления складов в `warehouses.txt` запустите тест:

```cmd
npm run test:api
```

Если ID правильные, вы увидите данные по остаткам.

---

## Пример реального запроса

Когда вы указываете ID склада в `warehouses.txt`, сервис формирует такой запрос:

```
GET https://api.moysklad.ru/api/remap/1.2/report/stock/all
  ?filter=moment=2025-12-01 07:00:00;archived=false;archived=true;store=https://api.moysklad.ru/api/remap/1.2/entity/store/12345678-1234-1234-1234-123456789abc
  &offset=0
  &limit=1000
```

**Параметры:**
- `moment` - дата/время для остатков
- `archived=false` и `archived=true` - включить все товары (архивные и неархивные)
- `store` - URL склада с вашим ID
- `offset` и `limit` - для пагинации

---

## Часто задаваемые вопросы

### Можно ли использовать название склада вместо ID?

❌ Нет, API МойСклад требует UUID склада, а не название.

### Сколько складов можно добавить?

✅ Неограниченное количество. Синхронизация будет выполняться последовательно для каждого склада.

### Что если ID склада неправильный?

⚠️ Вы получите ошибку от API МойСклад. Проверьте ID в веб-интерфейсе.

### Как синхронизировать только определенные склады?

✅ Просто оставьте в `warehouses.txt` только нужные ID (закомментируйте ненужные или удалите).

### Нужно ли указывать полный URL склада?

❌ Нет, указывайте только ID. Сервис автоматически формирует полный URL:
```
https://api.moysklad.ru/api/remap/1.2/entity/store/{ваш-ID}
```

---

## Структура ответа API (справка)

МойСклад возвращает данные в формате:

```json
{
  "context": {
    "employee": {...}
  },
  "meta": {
    "href": "...",
    "type": "stock",
    "mediaType": "application/json",
    "size": 1000,
    "limit": 1000,
    "offset": 0
  },
  "rows": [
    {
      "meta": {...},
      "stockByStore": [
        {
          "meta": {...},
          "name": "Название склада",
          "stock": 100,
          "reserve": 10,
          "inTransit": 5
        }
      ],
      "name": "Товар 1",
      "code": "00001",
      "article": "ART-001",
      "price": 1000.00,
      "quantity": 100
    }
  ]
}
```

---

## Дополнительная информация

Официальная документация МойСклад:
- [Отчет об остатках](https://dev.moysklad.ru/doc/api/remap/1.2/reports/#otchety-otchet-ostatki)
- [Склады](https://dev.moysklad.ru/doc/api/remap/1.2/dictionaries/#suschnosti-sklad)
- [Фильтрация](https://dev.moysklad.ru/doc/api/remap/1.2/#mojsklad-json-api-obschie-swedeniq-fil-traciq-wyborki-s-pomosch-u-parametra-filter)

