# Инструкция по установке на Windows

## Шаг 1: Установка зависимостей

Откройте командную строку (cmd) или PowerShell в папке проекта и выполните:

```cmd
npm install
```

## Шаг 2: Настройка переменных окружения

1. Скопируйте файл `env.example.txt` и переименуйте копию в `.env`
2. Откройте файл `.env` в текстовом редакторе (Notepad, VSCode и т.д.)
3. Заполните необходимые параметры:
   - `API_URL` - адрес вашего API
   - `API_KEY` - ключ доступа к API
   - `DB_HOST` - адрес сервера MySQL (обычно localhost)
   - `DB_USER` - пользователь MySQL
   - `DB_PASSWORD` - пароль пользователя MySQL
   - `DB_NAME` - название базы данных

## Шаг 3: Создание базы данных

Подключитесь к MySQL и выполните:

```sql
CREATE DATABASE stock_sync CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

Или используйте phpMyAdmin / MySQL Workbench для создания базы данных.

## Шаг 4: Настройка списка складов

Откройте файл `warehouses.txt` и добавьте коды складов (по одному на строку):

```
WAREHOUSE_01
WAREHOUSE_02
```

## Шаг 5: Запуск сервиса

### Разовый запуск (для тестирования)

```cmd
npm start
```

### Автоматический запуск при старте Windows

Рекомендуется использовать PM2:

1. Установите PM2 глобально:
```cmd
npm install -g pm2
```

2. Запустите сервис через PM2:
```cmd
pm2 start server.js --name stock-sync
```

3. Настройте автозапуск:
```cmd
pm2 save
pm2 startup
```

4. Выполните команду, которую выдаст PM2 (скопируйте и вставьте в командную строку с правами администратора)

### Альтернатива: Создание Windows службы

Можно использовать пакет `node-windows`:

1. Установите node-windows:
```cmd
npm install -g node-windows
```

2. Создайте файл `install-service.js` в папке проекта
3. Запустите установку службы

## Проверка работы

1. Откройте браузер и перейдите на http://localhost:3000
2. Проверьте статус: http://localhost:3000/health
3. Запустите синхронизацию вручную (через Postman или curl):

```cmd
curl -X POST http://localhost:3000/sync/manual
```

## Просмотр логов

Логи сохраняются в файл `logs/sync.log`

Для просмотра в реальном времени через PM2:
```cmd
pm2 logs stock-sync
```

## Остановка сервиса

### Если запущен через npm start
Нажмите `Ctrl+C` в командной строке

### Если запущен через PM2
```cmd
pm2 stop stock-sync
pm2 delete stock-sync
```

## Решение проблем

### Ошибка "Cannot find module"
Убедитесь, что установлены все зависимости:
```cmd
npm install
```

### Ошибка подключения к БД
- Проверьте, что MySQL запущен
- Проверьте параметры подключения в файле `.env`
- Убедитесь, что база данных создана

### Порт занят
Измените PORT в файле `.env` на другой (например, 3001)

### PM2 не найден
Установите PM2 глобально с правами администратора:
```cmd
npm install -g pm2
```

